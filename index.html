<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office TV Kiosk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            overflow: hidden;
            cursor: none; /* Hide cursor for kiosk mode */
        }

        .kiosk-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Slide styling */
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        .slide.active {
            opacity: 1;
            z-index: 1;
        }

        /* Image slide styling */
        .slide.image-slide {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .slide.image-slide::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent 20%, transparent 80%, rgba(0,0,0,0.3));
        }

        /* Power BI slide styling */
        .slide.powerbi-slide iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #fff;
        }

        /* Progress bar */
        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(to right, #0078d4, #50e6ff);
            width: 0%;
            transition: width linear;
            z-index: 1000;
            box-shadow: 0 0 10px rgba(0, 120, 212, 0.5);
        }

        /* Slide counter */
        .slide-counter {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Loading indicator */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #0078d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Date and Time display */
        .datetime-display {
            position: fixed;
            top: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .datetime-display .time {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .datetime-display .date {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Welcome message (optional) */
        .welcome-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #fff;
            z-index: 100;
            opacity: 0;
            animation: fadeInOut 8s ease-in-out;
            pointer-events: none;
        }

        .welcome-overlay h1 {
            font-size: 72px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .welcome-overlay p {
            font-size: 24px;
            opacity: 0.9;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }

        /* Error message */
        .error-message {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(232, 17, 35, 0.9);
            color: #fff;
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            font-size: 14px;
        }

        .error-message.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 100px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .datetime-display .time {
                font-size: 24px;
            }
            .welcome-overlay h1 {
                font-size: 48px;
            }
        }
    </style>
</head>
<body>
    <div class="kiosk-container" id="kioskContainer">
        <!-- Slides will be dynamically inserted here -->
    </div>

    <!-- Progress bar -->
    <div class="progress-bar" id="progressBar"></div>

    <!-- Slide counter -->
    <div class="slide-counter" id="slideCounter">1 / 1</div>

    <!-- Date and Time -->
    <div class="datetime-display">
        <div class="time" id="timeDisplay">00:00</div>
        <div class="date" id="dateDisplay">Monday, January 1, 2024</div>
    </div>

    <!-- Loading indicator -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Error message -->
    <div class="error-message" id="errorMessage"></div>

    <script>
        // ============================================================
        // CONFIGURATION - Edit this section
        // ============================================================
        const CONFIG = {
            // Slide duration in milliseconds (default: 15 seconds)
            slideDuration: 15000,
            
            // Power BI reports duration (longer for dashboards)
            powerBiDuration: 30000,
            
            // Auto-refresh interval (reload page every X hours to get fresh data)
            autoRefreshHours: 24,
            
            // Slides configuration
            slides: [
                // Image slides - use SharePoint image URLs
                {
                    type: 'image',
                    url: 'https://yourtenant.sharepoint.com/sites/yoursite/SiteAssets/kiosk/image1.jpg',
                    duration: 15000
                },
                {
                    type: 'image',
                    url: 'https://yourtenant.sharepoint.com/sites/yoursite/SiteAssets/kiosk/image2.jpg',
                    duration: 15000
                },
                
                // Power BI report slides
                {
                    type: 'powerbi',
                    embedUrl: 'https://app.powerbi.com/view?r=YOUR_REPORT_ID',
                    duration: 30000
                },
                
                {
                    type: 'image',
                    url: 'https://yourtenant.sharepoint.com/sites/yoursite/SiteAssets/kiosk/image3.jpg',
                    duration: 15000
                },
                
                {
                    type: 'powerbi',
                    embedUrl: 'https://app.powerbi.com/view?r=ANOTHER_REPORT_ID',
                    duration: 30000
                }
            ]
        };

        // ============================================================
        // KIOSK APPLICATION
        // ============================================================
        class TVKiosk {
            constructor(config) {
                this.config = config;
                this.currentSlideIndex = 0;
                this.slides = [];
                this.progressInterval = null;
                this.slideTimeout = null;
                this.isTransitioning = false;
                
                this.container = document.getElementById('kioskContainer');
                this.progressBar = document.getElementById('progressBar');
                this.slideCounter = document.getElementById('slideCounter');
                this.loading = document.getElementById('loading');
                this.errorMessage = document.getElementById('errorMessage');
                
                this.init();
            }

            init() {
                console.log('Initializing TV Kiosk...');
                this.createSlides();
                this.setupClock();
                this.startCarousel();
                this.setupAutoRefresh();
                this.setupErrorHandling();
            }

            createSlides() {
                this.container.innerHTML = ''; // Clear existing slides
                
                this.config.slides.forEach((slideConfig, index) => {
                    const slide = document.createElement('div');
                    slide.className = 'slide';
                    slide.dataset.index = index;
                    
                    if (slideConfig.type === 'image') {
                        slide.classList.add('image-slide');
                        slide.style.backgroundImage = `url('${slideConfig.url}')`;
                        
                        // Preload image
                        const img = new Image();
                        img.src = slideConfig.url;
                        img.onerror = () => this.showError(`Failed to load image: ${slideConfig.url}`);
                        
                    } else if (slideConfig.type === 'powerbi') {
                        slide.classList.add('powerbi-slide');
                        const iframe = document.createElement('iframe');
                        iframe.src = slideConfig.embedUrl;
                        iframe.allowFullscreen = true;
                        slide.appendChild(iframe);
                    }
                    
                    this.container.appendChild(slide);
                    this.slides.push({
                        element: slide,
                        config: slideConfig
                    });
                });
                
                // Show first slide
                if (this.slides.length > 0) {
                    this.slides[0].element.classList.add('active');
                    this.updateCounter();
                }
                
                console.log(`Created ${this.slides.length} slides`);
            }

            startCarousel() {
                if (this.slides.length === 0) {
                    this.showError('No slides configured');
                    return;
                }

                this.showSlide(0);
            }

            showSlide(index) {
                if (this.isTransitioning) return;
                
                this.isTransitioning = true;
                this.currentSlideIndex = index;
                
                // Hide all slides
                this.slides.forEach(slide => {
                    slide.element.classList.remove('active');
                });
                
                // Show current slide
                this.slides[index].element.classList.add('active');
                this.updateCounter();
                
                // Reset and start progress bar
                const duration = this.slides[index].config.duration || this.config.slideDuration;
                this.animateProgressBar(duration);
                
                // Schedule next slide
                clearTimeout(this.slideTimeout);
                this.slideTimeout = setTimeout(() => {
                    this.isTransitioning = false;
                    const nextIndex = (index + 1) % this.slides.length;
                    this.showSlide(nextIndex);
                }, duration);
            }

            animateProgressBar(duration) {
                // Reset progress bar
                this.progressBar.style.transition = 'none';
                this.progressBar.style.width = '0%';
                
                // Force reflow
                this.progressBar.offsetHeight;
                
                // Animate
                this.progressBar.style.transition = `width ${duration}ms linear`;
                this.progressBar.style.width = '100%';
            }

            updateCounter() {
                const current = this.currentSlideIndex + 1;
                const total = this.slides.length;
                this.slideCounter.textContent = `${current} / ${total}`;
            }

            setupClock() {
                const updateClock = () => {
                    const now = new Date();
                    
                    // Time
                    const hours = now.getHours().toString().padStart(2, '0');
                    const minutes = now.getMinutes().toString().padStart(2, '0');
                    document.getElementById('timeDisplay').textContent = `${hours}:${minutes}`;
                    
                    // Date
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    document.getElementById('dateDisplay').textContent = now.toLocaleDateString('en-US', options);
                };
                
                updateClock();
                setInterval(updateClock, 1000);
            }

            setupAutoRefresh() {
                // Refresh page every X hours to get latest content
                const refreshInterval = this.config.autoRefreshHours * 60 * 60 * 1000;
                setTimeout(() => {
                    console.log('Auto-refreshing page...');
                    location.reload();
                }, refreshInterval);
                
                console.log(`Auto-refresh scheduled in ${this.config.autoRefreshHours} hours`);
            }

            setupErrorHandling() {
                window.addEventListener('error', (event) => {
                    console.error('Global error:', event.error);
                    this.showError(`Error: ${event.message}`);
                });
            }

            showError(message) {
                console.error(message);
                this.errorMessage.textContent = message;
                this.errorMessage.classList.add('show');
                
                setTimeout(() => {
                    this.errorMessage.classList.remove('show');
                }, 5000);
            }

            // Public methods for manual control (accessible via browser console)
            pause() {
                clearTimeout(this.slideTimeout);
                this.progressBar.style.animationPlayState = 'paused';
                console.log('Carousel paused');
            }

            resume() {
                this.showSlide(this.currentSlideIndex);
                console.log('Carousel resumed');
            }

            next() {
                clearTimeout(this.slideTimeout);
                this.isTransitioning = false;
                const nextIndex = (this.currentSlideIndex + 1) % this.slides.length;
                this.showSlide(nextIndex);
            }

            previous() {
                clearTimeout(this.slideTimeout);
                this.isTransitioning = false;
                const prevIndex = (this.currentSlideIndex - 1 + this.slides.length) % this.slides.length;
                this.showSlide(prevIndex);
            }

            goto(index) {
                if (index >= 0 && index < this.slides.length) {
                    clearTimeout(this.slideTimeout);
                    this.isTransitioning = false;
                    this.showSlide(index);
                }
            }
        }

        // ============================================================
        // INITIALIZE ON PAGE LOAD
        // ============================================================
        let kiosk;
        
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, starting kiosk...');
            kiosk = new TVKiosk(CONFIG);
            
            // Make kiosk accessible in console for debugging
            window.kiosk = kiosk;
            console.log('Kiosk initialized. Use window.kiosk to control (e.g., kiosk.pause(), kiosk.next())');
        });

        // Prevent accidental navigation
        window.addEventListener('beforeunload', (e) => {
            // Uncomment to warn before closing
            // e.preventDefault();
            // e.returnValue = '';
        });

        // Keep screen awake (request wake lock if supported)
        if ('wakeLock' in navigator) {
            let wakeLock = null;
            
            const requestWakeLock = async () => {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Screen wake lock acquired');
                    
                    wakeLock.addEventListener('release', () => {
                        console.log('Screen wake lock released');
                    });
                } catch (err) {
                    console.error('Wake lock error:', err);
                }
            };
            
            requestWakeLock();
            
            // Reacquire wake lock when page becomes visible
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible') {
                    requestWakeLock();
                }
            });
        }

        // Keyboard shortcuts (for maintenance/setup)
        document.addEventListener('keydown', (e) => {
            if (!kiosk) return;
            
            switch(e.key) {
                case 'ArrowRight':
                case 'n':
                    kiosk.next();
                    break;
                case 'ArrowLeft':
                case 'p':
                    kiosk.previous();
                    break;
                case ' ':
                case 'k':
                    if (kiosk.slideTimeout) {
                        kiosk.pause();
                    } else {
                        kiosk.resume();
                    }
                    break;
                case 'r':
                    location.reload();
                    break;
            }
        });
    </script>
</body>
</html>
