<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Power BI Secure Embed</title>

  <!-- Power BI Client -->
  <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2.23.0/dist/powerbi.min.js"></script>

  <!-- Microsoft Authentication -->
  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #reportContainer {
      height: 100vh;
      width: 100vw;
    }
  </style>
</head>

<body>
  <div id="reportContainer"></div>

  <script>
    const msalConfig = {
      auth: {
        clientId: "YOUR_AZURE_AD_APP_ID",
        authority: "https://login.microsoftonline.com/YOUR_TENANT_ID",
        redirectUri: window.location.href
      }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);

    async function signInAndEmbed() {
      const loginResponse = await msalInstance.loginPopup({
        scopes: ["https://analysis.windows.net/powerbi/api/.default"]
      });

      const tokenResponse = await msalInstance.acquireTokenSilent({
        account: loginResponse.account,
        scopes: ["https://analysis.windows.net/powerbi/api/.default"]
      });

      const embedConfig = {
        type: "report",
        tokenType: powerbi.models.TokenType.Aad,
        accessToken: tokenResponse.accessToken,
        embedUrl: "https://app.powerbi.com/reportEmbed?reportId=REPORT_ID&groupId=WORKSPACE_ID",
        id: "REPORT_ID",
        permissions: powerbi.models.Permissions.All,
        settings: {
          panes: {
            filters: { visible: false },
            pageNavigation: { visible: false }
          }
        }
      };

      const container = document.getElementById("reportContainer");
      powerbi.embed(container, embedConfig);
    }

    signInAndEmbed();
  </script>
</body>
</html>
